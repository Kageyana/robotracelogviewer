# AGENTS

このリポジトリは、ロボトレースの走行中に記録したログデータを MATLAB App Designer で表示・解析するアプリです。  
ここでは、Codex などの AI エージェントが作業するときのルールと、開発者向けの簡単なガイドラインをまとめます。

---

## Dev environment tips

- このプロジェクトは **MATLAB + App Designer** を前提としたアプリケーションです。
- App Designer の `.mlapp` ファイルは **バイナリ形式** のため、**Codex では直接編集できません**。
- その代わりに、`.mlapp` のコード部分を **`src/test.txt`** にコピーしておき、  
  Codex / AI エージェントは **`src/test.txt` のみを編集対象** とします。

### `.mlapp` と `src/test.txt` の役割

- `.mlapp`
  - App Designer が使用するバイナリファイルです。
  - **AI エージェントは編集禁止**。人間のみが編集・保存します。
- `src/test.txt`
  - `.mlapp` の **コードビュー（classdef ～ end）のテキストコピー**を置くファイルです。
  - Codex / AI エージェントは、このファイルの MATLAB コードを編集します。
  - クラス定義の構造（`classdef`、`properties`、`methods` ブロックなど）は可能な限り保持してください。

### 人間（リポジトリオーナー）が行う作業

1. MATLAB App Designer で対象の `.mlapp` を開く。
2. Code View を開き、クラス定義全体（`classdef ... end`）をコピーする。
3. リポジトリ内の `src/test.txt` を開き、コピーしたコードを貼り付けて保存する。
4. その状態をコミットし、Codex が `src/test.txt` を編集できるようにする。
5. Codex が更新した `src/test.txt` を確認し、必要に応じて `.mlapp` のコードビューに手動で反映する。

### Codex / AI エージェントが行う作業

- 変更してよいファイルは **`src/test.txt` のみ** です。
- してよいこと
  - `src/test.txt` 内の MATLAB クラスコードの修正・リファクタリング。
  - メソッドやプロパティの追加、バグ修正、コメントの追加など。
- してはいけないこと
  - `.mlapp` / `.mlappinstall` の編集を試みること。
  - クラス名や主要コールバック名、UI コンポーネント名を無断で変更して互換性を壊すこと。
  - ファイル全体を別物に置き換えるような大規模な書き換え（特別な指示がない限り禁止）。

### `.mlapp` への反映について

- `src/test.txt` の内容を `.mlapp` に反映する作業は、**すべて人間が手動で行います**。
- Codex はあくまで **`src/test.txt` 上のテキスト編集だけ** を行う前提でコードを提案してください。

---

## Testing instructions

- 変更を `.mlapp` に反映したら、MATLAB 上でアプリを起動して **手動テスト** を行ってください。
- 最低限、次の動作を確認します。
  - ログファイルを読み込めること（エラーや例外が出ないこと）。
  - すべてのタブ（メイン画面 / 解析画面 / 設定画面 など）が開けること。
  - 主要ボタン・操作（読み込み、更新、描画 など）が期待通りに動作すること。
- エラーや警告が出た場合は、その状況をコメントとして `src/test.txt` 内に残しておくと、Codex が再修正しやすくなります。
- ロジックやデータ構造に関わる変更を行った場合は、サンプルログなど複数パターンのファイルで動作確認を行ってください。

---

## PR instructions

- PR タイトル形式:
  - `[robotracelogviewer] <Title>`
  - 例: `[robotracelogviewer] ログ読み込み処理の例外対応を追加`
- PR を作成する前に必ず行うこと:
  - `src/test.txt` と `.mlapp` の内容が同期していることを確認する。
  - アプリを起動し、基本的な操作フローがすべて完了することを確認する。
- 可能であれば、次のように変更内容を分けて PR を作成してください。
  - UI 変更（見た目や配置の変更）
  - ロジック変更（計算方法、データ処理など）
- Codex が生成したコードを含む場合でも、**必ず人間が差分をレビュー**し、
  - 意味のないフォーマット変更
  - 意図しない変数名・関数名の変更
  - 不要な削除や追加
  を取り除いてからマージしてください。
